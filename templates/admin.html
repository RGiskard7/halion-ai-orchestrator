<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panel de administraci√≥n</title>
  <link rel="stylesheet" href="/static/main.css">
</head>
<body>
<div class="container">
  <header>
    <h1>Panel Admin</h1>
    <p><a href="/">‚¨Ö Volver al chat</a></p>
  </header>

  {% if msg %}
    <p class="success-msg">{{ msg }}</p>
  {% endif %}

  <h2>Usuarios</h2>
  <ul>
    {% for uname, data in users.items() %}
      <li><strong>{{ uname }}</strong>: tools = {{ data.tools|join(', ') }}</li>
    {% endfor %}
  </ul>

  <!-- Secciones para crear/eliminar usuarios (ahora mismo no tienen l√≥gica real, pero las dejamos para el MVP) -->
  <form method="post" action="/admin/create-user">
    <h3>Crear usuario (MVP sin login real)</h3>
    <input type="text" name="username" placeholder="Usuario">
    <input type="password" name="password" placeholder="Contrase√±a">
    <input type="text" name="tools" placeholder="tools separadas por coma">
    <button type="submit">Crear</button>
  </form>

  <form method="post" action="/admin/delete-user">
    <h3>Eliminar usuario</h3>
    <select name="username">
      {% for uname in users.keys() %}
        {% if uname != 'edu' %}
          <option value="{{ uname }}">{{ uname }}</option>
        {% endif %}
      {% endfor %}
    </select>
    <button type="submit">Eliminar</button>
  </form>

  <form method="get" action="/admin/reload-tools">
    <button type="submit">üîÑ Recargar tools desde disco</button>
  </form>

  <hr>

  <h2>Tools din√°micas (memoria)</h2>
  <ul>
    {% for name, tool in tools.items() %}
      <li><strong>{{ name }}</strong>: {{ tool.schema.description }}</li>
    {% endfor %}
  </ul>

  <h2>Tools cargadas desde disco</h2>
  <ul>
    {% for name, tool in static_tools.items() %}
      <li><strong>{{ name }}</strong>: {{ tool.schema.description }}
        <!-- Bot√≥n eliminar tool -->
        <form method="post" action="/admin/delete-tool" style="display:inline;">
          <input type="hidden" name="name" value="{{ name }}">
          <button type="submit">‚ùå</button>
        </form>
        <!-- Bot√≥n editar tool -->
        <form method="get" action="/admin/edit-tool" style="display:inline;">
          <input type="hidden" name="name" value="{{ name }}">
          <button type="submit">‚úèÔ∏è</button>
        </form>
      </li>
    {% endfor %}
  </ul>

  <hr>

  <h2>Registrar nueva tool</h2>
  <form method="post" action="/admin/create-tool">
    <input type="text" name="name" placeholder="Nombre"><br>
    <input type="text" name="description" placeholder="Descripci√≥n"><br>
    <textarea name="json_schema" placeholder="JSON Schema" rows="6" cols="80"></textarea><br>
    <textarea name="func_code" placeholder="C√≥digo Python de la funci√≥n" rows="10" cols="80"></textarea><br>
    <button type="submit">Registrar tool</button>
  </form>

  <hr>

  <h2>Errores de carga</h2>
  {% if errors %}
    <ul>
      {% for e in errors %}
        <li><strong>{{ e.file }}</strong>: {{ e.error }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>‚úÖ No hay errores de carga.</p>
  {% endif %}

  <hr>

  <h2>√öltimos logs</h2>
  <ul>
    {% for log in logs %}
      <li><strong>{{ log.timestamp }}</strong> ‚Üí {{ log.function }}({{ log.arguments }}) = {{ log.result }}</li>
    {% endfor %}
  </ul>
</div>
</body>
</html>
